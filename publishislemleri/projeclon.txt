#!/bin/bash

# Betik başladığında mevcut log dosyasını sil
rm -f "$log_file"

# Betik başladığında bir başlangıç mesajı ekle
echo "Betik başlatıldı: $(date)" >> "$log_file"

# Betikteki adımları çalıştır ve hataları log dosyasına yaz
# Örnek adımlar:
echo "Adım 1: İşlem başlatıldı"
komut1 || echo "Hata: Adım 1 başarısız" >> "$log_file"

echo "Adım 2: İşlem başlatıldı"
komut2 || echo "Hata: Adım 2 başarısız" >> "$log_file"

# Betik sona erdiğinde bir bitiş mesajı ekle
echo "Betik tamamlandı: $(date)" >> "$log_file"

# Kaynak dosya yolu
source_folder="/C/Users/samet.turker/source/repos/TURKERBEY/DHBYS"

# Hedef dizin
target_folder="/C/Versiyonlar"

# Git'ten projenin son halini çek
cd "$target_folder" || exit

# Versiyon numarasını al
version_number=$(<$source_folder"/"version.txt)

# Parçaları ayır
IFS='.' read -ra version_parts <<< "$version_number"

# Son parçayı arttır
last_part=${version_parts[-1]}
((last_part++))

# Parçaları tekrar birleştir
new_version="${version_parts[0]}.${version_parts[1]}.${version_parts[2]}.${version_parts[3]}.$last_part"

echo "$new_version" > "$source_folder/version.txt"


folder_name="version_$version_number"
mkdir "$folder_name" || exit

# Kaynak dosyaları hedef klasöre kopyala
cp -r "$source_folder"/* "$target_folder/$folder_name" || exit

# Hedef dizine git init yapma
cd "$target_folder/$folder_name" || exit

# Değişiklikleri ekle, commit yap ve GitHub'a gönder

git init || exit
git add . || exit
git commit -m "Yeni versiyon $folder_name oluşturuldu" || exit
git remote add origin https://github.com/TURKERBEY/Versiyon.git || exit

# Git'ten şubeyi silmek
if git rev-parse --verify master &> /dev/null; then
    git push origin --delete master || exit
else
    echo "Şube 'master' zaten mevcut değil."
fi
git branch master

git push -u master|| exit

 